\def \SLIDEIN {1}
\def \SLIDETRANS {2}
\def \SLIDENRF {3}
\def \SLIDEDETECTORS {4}
\def \SLIDERESOLUTIONONE {5}
\def \SLIDERESOLUTIONTWO {6}
\def \SLIDERESOLUTIONTHREE {7}
\def \SLIDERESOLUTIONFOUR {8}
\def \SLIDEALTERNATIVERECAP {9}
\def \SLIDEALTERNATIVE {10}
\def \SLIDELASERRED {11}
\def \SLIDELASERORANGE {12}
\def \SLIDELASERGREEN {13}

\begin{textblock}{15.}(0., -5.)
    \begin{tikzpicture}
        %%% Definitions
        %% Mathematical constants
        \def \NWAVEFORMSAMPLES {50}

        %% Incoming EM wave
        \def \AMPLITUDE {0.4}
        \def \WAVEFORMLENGTH {2.5}
        \def \INWAVESTART {0.}
        \def \INREDY {1.5}
        \def \INREDWAVELENGTH {1.4}
        \def \INORANGEY {0.75}
        \def \INORANGEWAVELENGTH {1.2}
        \def \INGREENY {0.}
        \def \INGREENWAVELENGTH {1.0}
        \def \INBLUEY {-0.75}
        \def \INBLUEWAVELENGTH {0.8}
        \def \INVIOLETY {-1.5}
        \def \INVIOLETWAVELENGTH {0.6}

        %% Transmitted EM wave
        \def \TRANSWAVESTART {7.}

        %% Scattered EM wave
        \def \SCATTERINGANGLE {-75}
        \def \SCAWAVEFORMLENGTH {4.}

        %% States
        \def \GROUNDSTATEY {-2.}
        \def \INTERMEDIATESTATEY {-0.5}
        \def \EXCITEDSTATEY {2.}
        \def \STATEXSTART {3.}
        \def \STATEX {3.}

        %% Alternative states
        \def \ALTINTERMEDIATESTATEUPY {0.5}

        %% Transitions
        \def \EXCITATIONX {\STATEXSTART+0.2*\STATEX}
        \def \ELASTICX {\STATEXSTART+0.5*\STATEX}
        \def \INELASTICX {\STATEXSTART+0.8*\STATEX}

        %% Alternative transitions
        \def \ALTEXCITATIONX {\STATEXSTART+0.15*\STATEX}
        \def \ALTELASTICX {\STATEXSTART+0.25*\STATEX}
        \def \ALTEXCITATIONLOWX {\STATEXSTART+0.75*\STATEX}
        \def \ALTDECAYLOWX {\STATEXSTART+0.85*\STATEX}
        \def \ALTEXCITATIONUPX {\STATEXSTART+0.45*\STATEX}
        \def \ALTDECAYUPX {\STATEXSTART+0.55*\STATEX}

        %% Detector
        \def \DETECTORLENGTH {2.}
        \def \DETECTORRADIUS {0.5}
        \def \ABSDETECTORX {10.}
        \def \ABSDETECTORY {0.}
        \def \SCADETECTORX {6.}
        \def \SCADETECTORY {-4.}

        %%% Drawing
        %% Incoming EM waves
        \visible<-\SLIDELASERRED>{
            \draw [very thick, \RED, domain=\INWAVESTART:\INWAVESTART+\WAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\WAVEFORMLENGTH/\INREDWAVELENGTH*2*pi/4*\x r) + \INREDY});
        }

        \visible<-\SLIDEALTERNATIVE, \SLIDELASERORANGE>{
            \draw [very thick, \ORANGE, domain=\INWAVESTART:\INWAVESTART+\WAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\WAVEFORMLENGTH/\INORANGEWAVELENGTH*2*pi/4*\x r) + \INORANGEY});
        }

        \visible<-\SLIDEALTERNATIVE, \SLIDELASERGREEN>{
            \draw [very thick, \GREEN, domain=\INWAVESTART:\INWAVESTART+\WAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\WAVEFORMLENGTH/\INGREENWAVELENGTH*2*pi/4*\x r) + \INGREENY});
        }

        \visible<-\SLIDEALTERNATIVE>{
            \draw [very thick, \BLUE, domain=\INWAVESTART:\INWAVESTART+\WAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\WAVEFORMLENGTH/\INBLUEWAVELENGTH*2*pi/4*\x r) + \INBLUEY});

            \draw [very thick, \VIOLET, domain=\INWAVESTART:\INWAVESTART+\WAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\WAVEFORMLENGTH/\INVIOLETWAVELENGTH*2*pi/4*\x r) + \INVIOLETY});
        }

        %% Transmitted EM waves
        \visible<\SLIDETRANS-\SLIDEALTERNATIVERECAP>{
            \draw [very thick, \RED, domain=\TRANSWAVESTART:\TRANSWAVESTART+\WAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\WAVEFORMLENGTH/\INREDWAVELENGTH*2*pi/4*\x r) + \INREDY});

            \draw [very thick, \ORANGE, domain=\TRANSWAVESTART:\TRANSWAVESTART+\WAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\WAVEFORMLENGTH/\INORANGEWAVELENGTH*2*pi/4*\x r) + \INORANGEY});
        }
        \visible<\SLIDETRANS-\SLIDEALTERNATIVE>{
            \draw [very thick, \BLUE, domain=\TRANSWAVESTART:\TRANSWAVESTART+\WAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\WAVEFORMLENGTH/\INBLUEWAVELENGTH*2*pi/4*\x r) + \INBLUEY});

            \draw [very thick, \VIOLET, domain=\TRANSWAVESTART:\TRANSWAVESTART+\WAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\WAVEFORMLENGTH/\INVIOLETWAVELENGTH*2*pi/4*\x r) + \INVIOLETY});
        }

        %% States
        % Ground state
        \draw[very thick, black] (\STATEXSTART, \GROUNDSTATEY) -- (\STATEXSTART+\STATEX, \GROUNDSTATEY);
        \draw (\STATEXSTART + \STATEX, \GROUNDSTATEY) node[anchor=west] {$E_0$};

        % Intermediate state
        \draw[very thick, black] (\STATEXSTART, \INTERMEDIATESTATEY) -- (\STATEXSTART+\STATEX, \INTERMEDIATESTATEY);
        \draw (\STATEXSTART + \STATEX, \INTERMEDIATESTATEY) node[anchor=west] {$E_i$};

        % Excited state
        \draw[very thick, black] (\STATEXSTART, \EXCITEDSTATEY) -- (\STATEXSTART+\STATEX, \EXCITEDSTATEY);
        \draw (\STATEXSTART + \STATEX, \EXCITEDSTATEY) node[anchor=west] {$E_x$};

        %% Alternative intermediate level
        \visible<\SLIDEALTERNATIVE->{
            \draw[very thick, black] (\STATEXSTART, \ALTINTERMEDIATESTATEUPY) -- (\STATEXSTART+\STATEX, \ALTINTERMEDIATESTATEUPY);
            \draw (\STATEXSTART + \STATEX, \ALTINTERMEDIATESTATEUPY) node[anchor=west] {$E_j$};
        }

        %% Transitions

        \visible<\SLIDETRANS-\SLIDEALTERNATIVERECAP>{    
            % Excitation
            \draw[->, ultra thick, black] (\EXCITATIONX, \GROUNDSTATEY) -- (\EXCITATIONX, \EXCITEDSTATEY);
        }

        \visible<\SLIDENRF-\SLIDEALTERNATIVERECAP>{    
            % Direct ground-state decay
            \draw[->, ultra thick, black] (\ELASTICX, \EXCITEDSTATEY) -- (\ELASTICX, \GROUNDSTATEY);

            \draw [very thick, \GREEN, rotate around={\SCATTERINGANGLE:(\ELASTICX, 0.)}, domain=\ELASTICX:\ELASTICX+\SCAWAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\SCAWAVEFORMLENGTH/\INORANGEWAVELENGTH*2*pi/4*\x r)});

            % Decay via intermediate states
            \draw[->, ultra thick, black] (\INELASTICX, \EXCITEDSTATEY) -- (\INELASTICX, \INTERMEDIATESTATEY);

            \draw [very thick, \ORANGE, rotate around={\SCATTERINGANGLE:(\INELASTICX, \INTERMEDIATESTATEY + 0.5*(\EXCITEDSTATEY-\INTERMEDIATESTATEY))}, domain=\INELASTICX:\INELASTICX+\SCAWAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\SCAWAVEFORMLENGTH/\INORANGEWAVELENGTH*2*pi/4*\x r) + \INTERMEDIATESTATEY + 0.5*(\EXCITEDSTATEY-\INTERMEDIATESTATEY)});

            \draw[->, ultra thick, black] (\INELASTICX, \INTERMEDIATESTATEY) -- (\INELASTICX, \GROUNDSTATEY);

            \draw [very thick, \RED, rotate around={\SCATTERINGANGLE:(\INELASTICX, \GROUNDSTATEY + 0.5*(\INTERMEDIATESTATEY-\GROUNDSTATEY))}, domain=\INELASTICX:\INELASTICX+\SCAWAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\SCAWAVEFORMLENGTH/\INREDWAVELENGTH*2*pi/4*\x r) + \GROUNDSTATEY + 0.5*(\INTERMEDIATESTATEY-\GROUNDSTATEY)});
        }

        %% Alternative decays
        \visible<\SLIDEALTERNATIVE->{
            % Excitation
            \draw[->, ultra thick, black] (\ALTEXCITATIONX, \GROUNDSTATEY) -- (\ALTEXCITATIONX, \EXCITEDSTATEY);
            
            % Direct ground-state decay
            \draw[->, ultra thick, black] (\ALTELASTICX, \EXCITEDSTATEY) -- (\ALTELASTICX, \GROUNDSTATEY);
        }
        \visible<\SLIDEALTERNATIVE, \SLIDELASERGREEN>{
            \draw [very thick, \GREEN, rotate around={\SCATTERINGANGLE:(\ALTELASTICX, 0.)}, domain=\ALTELASTICX:\ALTELASTICX+\SCAWAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\SCAWAVEFORMLENGTH/\INGREENWAVELENGTH*2*pi/4*\x r)});
        }

        \visible<\SLIDEALTERNATIVE->{
            % Excitation and decay of upper intermediate state
            \draw[->, ultra thick, black] (\ALTEXCITATIONUPX, \GROUNDSTATEY) -- (\ALTEXCITATIONUPX, \ALTINTERMEDIATESTATEUPY);

            \draw[->, ultra thick, black] (\ALTDECAYUPX, \GROUNDSTATEY) -- (\ALTDECAYUPX, \ALTINTERMEDIATESTATEUPY);
        }
        \visible<\SLIDEALTERNATIVE, \SLIDELASERORANGE>{
            \draw [very thick, \ORANGE, rotate around={\SCATTERINGANGLE:(\ALTDECAYUPX, \GROUNDSTATEY + 0.5*(\ALTINTERMEDIATESTATEUPY-\GROUNDSTATEY))}, domain=\ALTDECAYUPX:\ALTDECAYUPX+\SCAWAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\SCAWAVEFORMLENGTH/\INORANGEWAVELENGTH*2*pi/4*\x r) + \GROUNDSTATEY + 0.5*(\ALTINTERMEDIATESTATEUPY-\GROUNDSTATEY)});
        }

        \visible<\SLIDEALTERNATIVE->{
            % Excitation and decay of upper intermediate state
            \draw[->, ultra thick, black] (\ALTEXCITATIONLOWX, \INTERMEDIATESTATEY) -- (\ALTEXCITATIONLOWX, \GROUNDSTATEY);

            \draw[->, ultra thick, black] (\ALTDECAYLOWX, \INTERMEDIATESTATEY) -- (\ALTDECAYLOWX, \GROUNDSTATEY);
        }
        \visible<\SLIDEALTERNATIVE, \SLIDELASERRED>{
            \draw [very thick, \RED, rotate around={\SCATTERINGANGLE:(\ALTDECAYLOWX, \GROUNDSTATEY + 0.5*(\INTERMEDIATESTATEY-\GROUNDSTATEY))}, domain=\ALTDECAYLOWX:\ALTDECAYLOWX+\SCAWAVEFORMLENGTH, samples=\NWAVEFORMSAMPLES] plot (\x, {\AMPLITUDE*sin(\SCAWAVEFORMLENGTH/\INREDWAVELENGTH*2*pi/4*\x r) + \GROUNDSTATEY + 0.5*(\INTERMEDIATESTATEY-\GROUNDSTATEY)});
        }

        \visible<\SLIDEDETECTORS->{
                %% Absorption detector
                \visible<-\SLIDEALTERNATIVE>{
                \draw[very thick, black, fill=gray]     (\ABSDETECTORX, \ABSDETECTORY) 
                -- (\ABSDETECTORX, \ABSDETECTORY + \DETECTORRADIUS)
                -- (\ABSDETECTORX + \DETECTORLENGTH, \ABSDETECTORY + \DETECTORRADIUS)
                -- (\ABSDETECTORX + \DETECTORLENGTH, \ABSDETECTORY - \DETECTORRADIUS)
                -- (\ABSDETECTORX, \ABSDETECTORY - \DETECTORRADIUS)
                -- (\ABSDETECTORX, \ABSDETECTORY);
            }

            %% Scattering detector
            \draw[very thick, black, rotate around={\SCATTERINGANGLE:(\SCADETECTORX, \SCADETECTORY)}, fill=gray]     (\SCADETECTORX, \SCADETECTORY) 
            -- (\SCADETECTORX, \SCADETECTORY + \DETECTORRADIUS)
            -- (\SCADETECTORX + \DETECTORLENGTH, \SCADETECTORY + \DETECTORRADIUS)
            -- (\SCADETECTORX + \DETECTORLENGTH, \SCADETECTORY - \DETECTORRADIUS)
            -- (\SCADETECTORX, \SCADETECTORY - \DETECTORRADIUS)
            -- (\SCADETECTORX, \SCADETECTORY);
        }
    \end{tikzpicture}
\end{textblock}

\def \SPECTRUMWIDTH {5.5}
\def \SPECTRUMY {2.6}
\def \SCASPECTRUMX {0.}
\def \TRASPECTRUMX {9.5}

\visible<\SLIDERESOLUTIONONE, \SLIDEALTERNATIVERECAP>{
    \begin{textblock}{\SPECTRUMWIDTH}(\SCASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/scattering_001.pdf}
    \end{textblock}

    \begin{textblock}{\SPECTRUMWIDTH}(\TRASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/transmission_001.pdf}
    \end{textblock}
}

\visible<\SLIDERESOLUTIONTWO>{
    \begin{textblock}{\SPECTRUMWIDTH}(\SCASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/scattering_005.pdf}
    \end{textblock}

    \begin{textblock}{\SPECTRUMWIDTH}(\TRASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/transmission_005.pdf}
    \end{textblock}
}

\visible<\SLIDERESOLUTIONTHREE>{
    \begin{textblock}{\SPECTRUMWIDTH}(\SCASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/scattering_01.pdf}
    \end{textblock}

    \begin{textblock}{\SPECTRUMWIDTH}(\TRASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/transmission_01.pdf}
    \end{textblock}
}

\visible<\SLIDERESOLUTIONFOUR>{
    \begin{textblock}{\SPECTRUMWIDTH}(\SCASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/scattering_03.pdf}
    \end{textblock}

    \begin{textblock}{\SPECTRUMWIDTH}(\TRASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/transmission_03.pdf}
    \end{textblock}
}

\visible<\SLIDEALTERNATIVE>{
    \begin{textblock}{\SPECTRUMWIDTH}(\SCASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/scattering_001.pdf}
    \end{textblock}

    \begin{textblock}{\SPECTRUMWIDTH}(\TRASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/transmission_alternative_001.pdf}
    \end{textblock}
}

\visible<\SLIDELASERRED>{
    \begin{textblock}{\SPECTRUMWIDTH}(\SCASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/scattering_single_0_001.pdf}
    \end{textblock}    
}

\visible<\SLIDELASERORANGE>{
    \begin{textblock}{\SPECTRUMWIDTH}(\SCASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/scattering_single_1_001.pdf}
    \end{textblock}    
}

\visible<\SLIDELASERGREEN>{
    \begin{textblock}{\SPECTRUMWIDTH}(\SCASPECTRUMX, \SPECTRUMY)
        \includegraphics[width=\textwidth]{figures/python/scattering_single_2_001.pdf}
    \end{textblock}    
}